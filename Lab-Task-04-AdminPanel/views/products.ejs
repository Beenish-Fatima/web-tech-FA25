<%- include('partials/header') %>

    <!-- Hero Section -->
    <section class="page-hero">
        <div class="container">
            <h1>Our Products & Services</h1>
            <p>Browse our digital products and professional services</p>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products-section">
        <div class="container">
            <!-- Filters -->
            <div class="filters">
                <form method="GET" action="/products" class="filter-form">
                    <div class="filter-group">
                        <label>Category</label>
                        <select name="category">
                            <option value="all" <%= !query.category || query.category === 'all' ? 'selected' : '' %>>All Categories</option>
                            <% categories.forEach(category => { %>
                                <option value="<%= category %>" <%= query.category === category ? 'selected' : '' %>>
                                    <%= category %>
                                </option>
                            <% }); %>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label>Price Range</label>
                        <div class="price-range">
                            <input type="number" name="minPrice" placeholder="Min" value="<%= query.minPrice || '' %>">
                            <span>to</span>
                            <input type="number" name="maxPrice" placeholder="Max" value="<%= query.maxPrice || '' %>">
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <label>Search</label>
                        <input type="text" name="search" placeholder="Search products..." value="<%= query.search || '' %>">
                    </div>
                    
                    <div class="filter-buttons">
                        <button type="submit" class="btn btn-primary">Apply Filters</button>
                        <a href="/products" class="btn btn-outline">Reset</a>
                    </div>
                </form>
            </div>

            <!-- Results Summary -->
            <div class="results-summary">
                <div>
                    <h2>Products Found: <%= totalProducts %></h2>
                </div>
                <div>
                    <form method="GET" action="/products" class="limit-form">
                        <input type="hidden" name="category" value="<%= query.category || '' %>">
                        <input type="hidden" name="minPrice" value="<%= query.minPrice || '' %>">
                        <input type="hidden" name="maxPrice" value="<%= query.maxPrice || '' %>">
                        <input type="hidden" name="search" value="<%= query.search || '' %>">
                        <label>Show:</label>
                        <select name="limit" onchange="this.form.submit()">
                            <option value="5" <%= limit == 5 ? 'selected' : '' %>>5</option>
                            <option value="10" <%= limit == 10 ? 'selected' : '' %>>10</option>
                            <option value="20" <%= limit == 20 ? 'selected' : '' %>>20</option>
                            <option value="50" <%= limit == 50 ? 'selected' : '' %>>50</option>
                        </select>
                    </form>
                </div>
            </div>

            <!-- Products Grid -->
            <% if (products.length === 0) { %>
                <div class="no-products">
                    <i class="fas fa-search"></i>
                    <h3>No products found</h3>
                    <p>Try adjusting your filters or search terms</p>
                    <a href="/products" class="btn btn-primary">View All Products</a>
                </div>
            <% } else { %>
                <div class="products-grid">
                    <% products.forEach(product => { %>
                        <div class="product-card">
                            <div class="product-image">
                                <img src="<%= product.image %>" alt="<%= product.name %>">
                                <% if (product.featured) { %>
                                    <span class="featured-badge">Featured</span>
                                <% } %>
                                <span class="category-badge"><%= product.category %></span>
                            </div>
                            <div class="product-content">
                                <div class="product-header">
                                    <h3><%= product.name %></h3>
                                    <span class="product-price">$<%= product.price.toFixed(2) %></span>
                                </div>
                                <p class="product-description"><%= product.description.substring(0, 100) %>...</p>
                                <div class="product-meta">
                                    <div class="product-rating">
                                        <i class="fas fa-star"></i>
                                        <span><%= product.rating %></span>
                                    </div>
                                    <div>
                                        <% 
                                        let stockClass = 'stock-in-stock';
                                        if (product.stock <= 5 && product.stock > 0) {
                                            stockClass = 'stock-low';
                                        } else if (product.stock <= 0) {
                                            stockClass = 'stock-out';
                                        }
                                        %>
                                        <span class="product-stock <%= stockClass %>">
                                            <%= product.stock > 0 ? `${product.stock} in stock` : 'Out of stock' %>
                                        </span>
                                    </div>
                                </div>
                                <a href="/products/<%= product._id %>" class="btn btn-primary view-details-btn">
                                    View Details
                                </a>
                            </div>
                        </div>
                    <% }); %>
                </div>

                <!-- Pagination -->
                <% if (totalPages > 1) { %>
                    <div class="pagination">
                        <% if (currentPage > 1) { %>
                            <a href="/products?page=<%= currentPage - 1 %>&limit=<%= limit %><%= query.category ? '&category=' + query.category : '' %><%= query.minPrice ? '&minPrice=' + query.minPrice : '' %><%= query.maxPrice ? '&maxPrice=' + query.maxPrice : '' %><%= query.search ? '&search=' + query.search : '' %>" 
                               class="btn btn-outline">
                                <i class="fas fa-chevron-left"></i> Previous
                            </a>
                        <% } %>
                        
                        <% for (let i = 1; i <= totalPages; i++) { %>
                            <% if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) { %>
                                <a href="/products?page=<%= i %>&limit=<%= limit %><%= query.category ? '&category=' + query.category : '' %><%= query.minPrice ? '&minPrice=' + query.minPrice : '' %><%= query.maxPrice ? '&maxPrice=' + query.maxPrice : '' %><%= query.search ? '&search=' + query.search : '' %>" 
                                   class="<%= i === currentPage ? 'btn btn-primary' : 'btn btn-outline' %>">
                                    <%= i %>
                                </a>
                            <% } else if (i === currentPage - 3 || i === currentPage + 3) { %>
                                <span class="btn btn-outline">...</span>
                            <% } %>
                        <% } %>
                        
                        <% if (currentPage < totalPages) { %>
                            <a href="/products?page=<%= currentPage + 1 %>&limit=<%= limit %><%= query.category ? '&category=' + query.category : '' %><%= query.minPrice ? '&minPrice=' + query.minPrice : '' %><%= query.maxPrice ? '&maxPrice=' + query.maxPrice : '' %><%= query.search ? '&search=' + query.search : '' %>" 
                               class="btn btn-outline">
                                Next <i class="fas fa-chevron-right"></i>
                            </a>
                        <% } %>
                    </div>
                <% } %>
            <% } %>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta">
        <div class="container">
            <h2>Need a Custom Solution?</h2>
            <p>Contact us for personalized digital services tailored to your specific needs</p>
            <a href="/contact" class="btn btn-light">Get a Quote</a>
        </div>
    </section>

<%- include('partials/footer') %>